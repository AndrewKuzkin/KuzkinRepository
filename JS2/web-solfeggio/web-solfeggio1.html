<html>
<head>
    <title>WEB-сольфеджио</title>
</head>
<body>
<h3>Проиграть  все ноты первой октавы</h3>
<button onclick="playOctava()">Play</button><hr>

<h3>Проиграть  аккорд</h3>
<button onclick="playChord()">Play</button><hr>

<h3>Проиграть  мелодию &quot;Слушай,Ленинград&quot;!</h3>
<button onclick="playMelody(Leningrad)">Play</button><hr>

<h3>Проиграть  мелодию из строки ввода</h3>
Формат мелодии: нота 1, длительность 1, ..., нота N, длительность N<br>
Допустимые ноты A4, A#4, ..., G4, G#4, H4<br>
Длительности вводятся в миллисекундах<br>

<input type="text" id="melodyInput" placeholder="Введите мелодию:">
<button onclick="playMelodyFromInput()">Play</button>

<script>
const octava = {
	'C4': 261.63,
	'C#4': 277.18,
	'D4': 293.66,
	'D#4': 311.13,
	'E4': 329.63,
	'F4': 349.23,
	'F#4': 369.99,
	'G4': 392.00,
	'G#4': 415.30,
	'A4': 440.00,
	'A#4': 466.16,
	'B4': 493.88,
	'P': 0 // Пауза
};
		 const Leningrad = ['E4', 1000, 'C4', 750, 'D4', 250, 'E4', 1000, 'A4', 750, 'G#4', 250, 'E4', 3000];

        async function playSound(freq, dur) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.value = freq;
            oscillator.connect(audioContext.destination);
            oscillator.start();
            await new Promise(resolve => setTimeout(resolve, dur));
            oscillator.stop();
        };

        async function playOctava() {
			for (const note in octava) {
				await playSound(octava[note], 250);
			}
		};

          function playChord() {
			const chord = ['C4',  'E4', 'G4', 2000];
			for (let i = 0; i < chord.length; i++) {
				playSound(octava[chord[i]], chord[chord.length-1]);
			};
		};

		 async function playMelody(melody) {
			for (let i = 0; i < melody.length; i += 2) {
				await playSound(octava[melody[i]], melody[i+1]);
			};
		};

        function parseMelody(melody) {
            return melody.split(', ').map((item, index) => index % 2 === 0 ? item : parseInt(item));
        };

        function playMelodyFromInput() {
				const melodyStr = document.getElementById('melodyInput').value;
            const melody = parseMelody(melodyStr);

            // Проверка на валидность мелодии
            /*
			if (melody.length % 2 !== 0) {
                alert('Введите мелодию в формате: A4, 500,H4, 300');
                return;
            };
*/            
			playMelody(melody);
        };
    
</script>
</body>
		</html>
